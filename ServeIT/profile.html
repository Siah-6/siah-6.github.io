<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ServeIT | Profile</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- animation -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

    <!-- css -->
    <link rel="stylesheet" href="assets/css/nav/nav.css">
    <link rel="icon" href="assets/images/nav/logo-nav.png">
    <link rel="stylesheet" href="assets/css/footer/footer.css">
    <link rel="stylesheet" href="assets/css/product/product.css">
    <link rel="stylesheet" href="assets/css/services/services.css">
    <link rel="stylesheet" href="assets/css/profile/profile.css">
</head>

<body>
    <div id="nav-container"></div>
    <div class="profile-container">
        <div>
            <div class="profile-header">
                <div class="profile-info">
                    <div id="profile-pic-container">
                        <!-- Profile picture will be dynamically inserted here -->
                    </div>
                    <div>
                        <div class="profile-name" id="profile-username">Loading...</div>
                        <div class="since">Member Since 2025</div>
                    </div>
                </div>
                <div class="header-buttons">
                    <a href="edit-profile.html" class="btn btn-message">Edit</a>
                    <button class="btn btn-logout" onclick="handleLogout()">Log out</button>
                </div>
            </div>

            <div class="tabs">
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="showTab('services', this)">Services</button>
                    <button class="tab-btn" onclick="showTab('products', this)">Products</button>
                </div>

                <div id="services" class="tab-content">
                    <div class="row d-flex justify-content-center align-items-center" id="services-container">
                        <!-- Services will be dynamically inserted here -->
                    </div>
                    <button class="show-all" onclick="showAllItems('services')">Show all</button>
                </div>

                <div id="products" class="tab-content" style="display: none;">
                    <div class="row d-flex justify-content-center align-items-center" id="products-container">
                        <!-- Products will be dynamically inserted here -->
                    </div>
                    <button class="show-all" onclick="showAllItems('products')">Show all</button>
                </div>
            </div>
        </div>
    </div>

    <!-- smpayment -->
    <div id="smpayment-container"></div>
    <!-- footer -->
    <div id="footer-container"></div>

    <!-- scroll animation  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.min.js"></script>
    <script>
        new WOW({
            offset: 200,
            mobile: true,
        }).init();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="sharedAssets/darkmode.js"></script>
    <script src="js/data.js"></script>
    <script src="js/session.js"></script>
    <script src="js/main.js"></script>
    <script>
        // Check login status - redirect to login if not authenticated
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = sessionManager.getCurrentUser();
            if (!currentUser || !currentUser.isLoggedIn) {
                window.location.href = 'login.html';
                return;
            }
            
            // Initialize page if logged in
            initializeProfilePage();
        });
        
        function initializeProfilePage() {
            loadNavigation();
            loadFooter();
            loadSMPayment();
            loadUserProfile();
            loadServices();
            loadProducts();
        }
        
        // Load user profile
        function loadUserProfile() {
            const currentUser = sessionManager.getCurrentUser();
            const profilePicContainer = document.getElementById('profile-pic-container');
            const usernameElement = document.getElementById('profile-username');
            
            if (currentUser) {
                // Load profile picture
                if (currentUser.profilePicture) {
                    profilePicContainer.innerHTML = `
                        <img src="uploads/${currentUser.profilePicture}" alt="Profile" class="profile-pic">
                    `;
                } else {
                    profilePicContainer.innerHTML = `<div class="profile-pic"></div>`;
                }
                
                // Load username
                usernameElement.textContent = currentUser.username.charAt(0).toUpperCase() + currentUser.username.slice(1);
            }
        }
        
        // Load services
        function loadServices() {
            const container = document.getElementById('services-container');
            const services = getServices().slice(0, 10); // Get 10 random services
            
            let html = '';
            services.forEach((service, index) => {
                const hiddenClass = index >= 4 ? 'hidden-item animate__animated animate__backInUp' : 'd-flex flex-row animate__animated animate__fadeIn';
                html += `
                    <div class="col-lg-3 col-6 ${hiddenClass} justify-content-center">
                        <div class="serviceCard rounded mx-auto">
                            <div class="card-body d-flex flex-column justify-content-center align-items-center">
                                <div class="serviceImage">
                                    <img src="assets/images/items/${service.attachment}" alt="${service.title}">
                                </div>
                                <div class="w-100 d-flex justify-content-between align-items-center">
                                    <span class="serviceTitle">${service.title}</span>
                                    <span class="servicePrice">₱${service.price}</span>
                                </div>
                                <div class="w-100 d-flex justify-content-between align-items-center">
                                    <p class="serviceDescription">${service.shortDescription}</p>
                                    <a href="serviceInfo.html?itemID=${service.itemID}">
                                        <button class="btnSeeMore rounded-pill">See More</button>
                                    </a>
                                </div>
                                <div class="line" style="border-top: 2px solid black; width: 100%; margin: 10px 0;"></div>
                                <div class="category">
                                    <span>${service.categoryName}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Load products
        function loadProducts() {
            const container = document.getElementById('products-container');
            const products = getProducts().slice(0, 10); // Get 10 random products
            
            let html = '';
            products.forEach((product, index) => {
                const hiddenClass = index >= 4 ? 'hidden-item animate__animated animate__backInUp' : 'd-flex flex-row animate__animated animate__fadeIn';
                html += `
                    <div class="col-lg-3 col-6 ${hiddenClass} justify-content-center">
                        <div class="serviceCard rounded mx-auto">
                            <div class="card-body d-flex flex-column justify-content-center align-items-center">
                                <div class="serviceImage">
                                    <img src="assets/images/items/${product.attachment}" alt="${product.title}">
                                </div>
                                <div class="w-100 d-flex justify-content-between align-items-center">
                                    <span class="serviceTitle">${product.title}</span>
                                    <span class="servicePrice">₱${product.price}</span>
                                </div>
                                <div class="w-100 d-flex justify-content-between align-items-center">
                                    <p class="serviceDescription">${product.shortDescription}</p>
                                    <a href="productInfo.html?itemID=${product.itemID}">
                                        <button class="btnSeeMore rounded-pill">See More</button>
                                    </a>
                                </div>
                                <div style="border-top: 2px solid black; width: 100%; margin: 10px 0;"></div>
                                <div class="category">
                                    <span>${product.categoryName}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Tab functionality (from original PHP)
        function showTab(tabName, buttonElement) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });

            // Remove 'active' class from all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show the selected tab
            document.getElementById(tabName).style.display = 'block';

            // Add 'active' class to the clicked button
            buttonElement.classList.add('active');

            // Reset "Show All" functionality when switching tabs
            document.querySelectorAll('.hidden-item').forEach(item => {
                item.style.display = 'none';
            });
            const showAllButton = document.querySelectorAll('.show-all');
            showAllButton.forEach(button => {
                button.textContent = 'Show All';
            });
        }

        function showAllItems(tabId) {
            const tabContent = document.getElementById(tabId);
            const hiddenItems = tabContent.querySelectorAll('.hidden-item');
            const showAllButton = tabContent.querySelector('.show-all');

            let isVisible = hiddenItems[0]?.style.display === 'block';

            hiddenItems.forEach(item => {
                item.style.display = isVisible ? 'none' : 'block';
            });

            // Toggle the button text based on visibility of items
            showAllButton.textContent = isVisible ? 'Show All' : 'Show Less';
        }
        
        // Handle logout
        function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                sessionManager.logout();
                window.location.href = 'login.html';
            }
        }
    </script>

</body>

</html>

