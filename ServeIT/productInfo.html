<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ServeIT | Product Details</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- animation -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

    <!-- css -->
    <link rel="stylesheet" href="assets/css/nav/nav.css">
    <link rel="icon" href="assets/images/nav/logo-nav.png">
    <link rel="stylesheet" href="assets/css/product/productInfo.css">
    <link rel="stylesheet" href="assets/css/footer/footer.css">

    <style>
        .active3 {
            color: #19AFA5;
        }

        body.dark-mode .active3 {
            color: #19afa5 !important;
        }
    </style>
</head>

<body>
    <div id="nav-container"></div>

    <div class="container animate__animated animate__fadeIn" style="margin-top: 30px;">
        <div class="row" id="product-detail-container">
            <!-- Product details will be dynamically inserted here -->
        </div>
    </div>

    <!-- footer -->
    <div id="footer-container"></div>

    <!-- scroll animation  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.min.js"></script>
    <script>
        new WOW({
            offset: 200,
            mobile: true,
        }).init();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <script src="js/data.js"></script>
    <script src="js/session.js"></script>
    <script src="js/main.js"></script>
    <script>
        let currentProduct = null;

        // Get product ID from URL
        function getProductIDFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('itemID');
        }

        // Load product details
        function loadProductDetails() {
            const productID = getProductIDFromURL();
            
            if (!productID) {
                window.location.href = 'products.html';
                return;
            }

            currentProduct = getItemById(productID);
            
            if (!currentProduct || currentProduct.type !== 'product') {
                window.location.href = 'products.html';
                return;
            }

            renderProductDetails();
        }

        // Render product details
        function renderProductDetails() {
            const container = document.getElementById('product-detail-container');
            
            container.innerHTML = `
                <div class="row justify-content-center">
                    <div class="col-lg-6">
                        <div class="imageContainer">
                            <div class="row">
                                <div class="col d-flex justify-content-center align-items-center">
                                    <div class="imageCard">
                                        <img src="assets/images/items/${currentProduct.attachment}"
                                            alt="${currentProduct.title}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 d-flex align-items-center text-start">
                        <div class="serviceInfo">
                            <h1 class="productTitleInfo pt-1" style="font-size: 32px;">
                                ${currentProduct.title}
                            </h1>
                            <p style="font-size: 14px;">${currentProduct.shortDescription}</p>
                            <p class="reviewStars">
                                <i class="fa-solid fa-star" style="color: #19AFA5;"></i>
                                <i class="fa-solid fa-star" style="color: #19AFA5;"></i>
                                <i class="fa-solid fa-star" style="color: #19AFA5;"></i>
                                <i class="fa-solid fa-star" style="color: #19AFA5;"></i>
                                <i class="fa-regular fa-star"></i>
                                <span class="rating-value ms-2" style="font-size: 14px;">Reviews</span>
                            </p>
                            <div class="price fw-bold">
                                <span style="font-size: 32px;">â‚±${currentProduct.price}</span><span>.00</span>
                            </div>
                            <div style="border-top: 2px solid #19AFA5; width: 100%; margin: 10px 0; "></div>
                            <h4 class="productDescriptionTitle fw-bold" style="font-size: 16;">PRODUCT DESCRIPTION</h4>
                            <p class="productDescriptionInfo" style="font-size: 14px;">
                                ${currentProduct.description}
                            </p>
                            <form method="POST">
                                <div class="productButtons">
                                    <input type="hidden" value="Product Item" name="addCart">
                                    <button name="btnAddCart" class="btnAddCart rounded-pill" style="font-size: 14px;"
                                        onclick="handleAddToCart(event)">ADD TO CART</button>
                                    <input type="hidden" value="Product Item" name="buyNow">
                                    <button type="submit" class="btnBuyNow rounded-pill" name="btnBuyNow"
                                        style="font-size: 14px;" onclick="handleBuyNow(event)">BUY NOW</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;
            
            // Load feedback section
            loadFeedbackSection();
        }
        
        // Load feedback section
        function loadFeedbackSection() {
            const container = document.getElementById('product-detail-container');
            
            // Add line divider
            container.innerHTML += `
                <div class="container">
                    <div class="line-divider">
                    </div>
                </div>
            `;
            
            // Add feedback section
            container.innerHTML += `
                <div class="container mb-5">
                    <div class="row">
                        <div class="col-12 mb-4">
                            <h2 class="productFeedbackTitle fw-bold">PRODUCT FEEDBACK</h2>
                        </div>
                        <div class="col-12">
                            <div class="feedbackCardContainer d-flex">
                                <div class="row justify-content-center g-4 w-100">
                                    <div class="col-lg-4 col-md-6 col-12">
                                        <form method="POST">
                                            <div class="feedbackCard">
                                                <div class="row">
                                                    <div class="col-6">
                                                        <div class="row-6">
                                                            <div class="profilePicture">
                                                                <img src="uploads/default.png" alt="Profile Picture">
                                                            </div>
                                                            <div class="username">${sessionManager.getCurrentUser().username}</div>
                                                        </div>
                                                        <div class="row-6">
                                                            <input type="text" class="feedbackInput form-control" name="feedback"
                                                                placeholder="Share feedback..." />
                                                        </div>
                                                    </div>
                                                    <div class="col-6">
                                                        <input type="hidden" name="ratingValue" id="ratingValue">
                                                        <p class="stars" id="ratingStars">
                                                            <i class="fa-solid fa-star" data-value="1" onclick="setRating(1)"></i>
                                                            <i class="fa-solid fa-star" data-value="2" onclick="setRating(2)"></i>
                                                            <i class="fa-solid fa-star" data-value="3" onclick="setRating(3)"></i>
                                                            <i class="fa-solid fa-star" data-value="4" onclick="setRating(4)"></i>
                                                            <i class="fa-solid fa-star" data-value="5" onclick="setRating(5)"></i>
                                                        </p>
                                                        <button class="btnAddFeedback rounded-pill" type="submit"
                                                            name="btnAddFeedback" onclick="handleAddFeedback(event)">Add Feedback</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Handle functions
        function handleAddToCart(event) {
            event.preventDefault();
            // Add to cart logic here
            alert('Added to cart!');
        }
        
        function handleBuyNow(event) {
            event.preventDefault();
            // Buy now logic here
            window.location.href = 'cart.html';
        }
        
        function handleAddFeedback(event) {
            event.preventDefault();
            const feedback = document.querySelector('input[name="feedback"]').value;
            const rating = document.getElementById('ratingValue').value;
            
            if (feedback && rating) {
                alert('Feedback added successfully!');
                // Reset form
                document.querySelector('input[name="feedback"]').value = '';
                setRating(0);
            }
        }
        
        function setRating(rating) {
            document.getElementById('ratingValue').value = rating;
            const stars = document.querySelectorAll('#ratingStars i');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('fa-solid');
                    star.classList.remove('fa-regular');
                    star.style.color = '#19AFA5';
                } else {
                    star.classList.remove('fa-solid');
                    star.classList.add('fa-regular');
                    star.style.color = '';
                }
            });
        }
        
        // Initialize page when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            sessionManager.requireAuth();
            
            // Load product details
            loadProductDetails();

            // Load navigation and footer
            loadNavigation();
            loadFooter();
            loadSMPayment();
        });
    </script>
    <!-- icons -->
    <script src="https://kit.fontawesome.com/d3ed67e674.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <!-- scroll animation  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.min.js"></script>
    <script>
        new WOW({
            offset: 200,
            mobile: true,
        }).init();
    </script>
    <script src="sharedAssets/darkmode.js"></script>
    <script src="js/data.js"></script>
    <script src="js/session.js"></script>
    <script src="js/main.js"></script>
    <script>
        // Re-initialize dropdowns after Bootstrap loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize page
            loadProductDetails();
            loadNavigation();
            loadFooter();
            loadSMPayment();
            
            // Ensure dropdowns work after navigation loads
            setTimeout(() => {
                const dropdownElements = document.querySelectorAll('[data-bs-toggle="dropdown"]');
                dropdownElements.forEach(element => {
                    new bootstrap.Dropdown(element);
                });
            }, 100);
        });
    </script>

</body>

</html>
