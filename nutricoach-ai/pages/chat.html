<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0A1628">
    <title>AI Coach Chat - NutriCoach AI</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/dark-theme.css">
    <link rel="stylesheet" href="../assets/css/chat-dark.css">
</head>
<body class="dark-theme">
    <div class="chat-page-container">
        <div class="chat-header">
            <button class="back-btn" onclick="window.location.href='dashboard.html'">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>
            <div>
                <h1>ðŸ¤– AI Coach</h1>
            </div>
            <div class="ai-status">
                <span class="status-dot"></span>
                <span>Online</span>
            </div>
        </div>
        
        <div class="chat-messages-container" id="chatMessages">
            <div class="welcome-message">
                <div class="ai-avatar">ðŸ¤–</div>
                <h2>Hi, I'm your AI Coach!</h2>
                <p>Ask me anything about fitness, nutrition, or your workout plan</p>
                
                <div class="suggested-questions">
                    <div class="suggested-question" onclick="sendSuggestedQuestion('How am I doing this week?')">
                        <span class="icon">ðŸ“Š</span>
                        <span class="text">How am I doing this week?</span>
                    </div>
                    <div class="suggested-question" onclick="sendSuggestedQuestion('What should I work on today?')">
                        <span class="icon">ðŸ’ª</span>
                        <span class="text">What should I work on today?</span>
                    </div>
                    <div class="suggested-question" onclick="sendSuggestedQuestion('Give me motivation!')">
                        <span class="icon">ðŸ”¥</span>
                        <span class="text">Give me motivation!</span>
                    </div>
                    <div class="suggested-question" onclick="sendSuggestedQuestion('Tips for my goal?')">
                        <span class="icon">ðŸŽ¯</span>
                        <span class="text">Tips for my goal?</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="chat-input-container">
            <form class="chat-input-form" id="chatForm">
                <textarea 
                    class="chat-input" 
                    id="messageInput" 
                    placeholder="Type your message..." 
                    rows="1"
                    required
                ></textarea>
                <button type="submit" class="send-btn" id="sendBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                    </svg>
                </button>
            </form>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const chatForm = document.getElementById('chatForm');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        let isFirstMessage = true;

        // Predefined AI responses
        const aiResponses = {
            'how am i doing this week?': [
                "You're doing great! You've completed 5 workouts this week and hit your protein goals 4 out of 7 days. Keep up the consistency! ðŸ’ª",
                "Excellent progress! Your workout streak is at 5 days and you've logged your weight consistently. You're on track to reach your goal! ðŸŽ¯"
            ],
            'what should i work on today?': [
                "Based on your plan, today is chest day! Focus on bench press, incline press, and cable flyes. Don't forget to warm up properly! ðŸ”¥",
                "Today's workout targets your chest muscles. Start with bench press for strength, then move to incline press for upper chest development. You've got this! ðŸ’ª"
            ],
            'give me motivation!': [
                "Remember why you started! Every workout brings you closer to your goals. You're stronger than you think! ðŸ”¥ðŸ’ª",
                "You've already come so far! The only bad workout is one that didn't happen. Let's crush it today! ðŸŽ¯",
                "Your future self will thank you for the work you're putting in today. Stay consistent and stay hungry! ðŸš€"
            ],
            'tips for my goal?': [
                "For muscle gain, focus on progressive overload. Increase weight gradually and ensure you're getting enough protein (1.6-2.2g per kg bodyweight). ðŸ‹ï¸",
                "Nutrition is 70% of the game! Track your calories, prioritize whole foods, and don't skip rest days. Recovery is when you actually grow! ðŸ’ª"
            ],
            'default': [
                "That's a great question! Based on your fitness profile, I recommend focusing on consistency and proper form. Quality over quantity! ðŸŽ¯",
                "I'm here to help! Remember to listen to your body, stay hydrated, and celebrate small wins along the way. You're doing amazing! ðŸ’ª",
                "Great mindset! Keep pushing yourself but also know when to rest. Balance is key to long-term success in fitness! ðŸ”¥"
            ]
        };

        // Auto-resize textarea
        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });

        // Send suggested question
        function sendSuggestedQuestion(question) {
            messageInput.value = question;
            chatForm.dispatchEvent(new Event('submit'));
        }

        // Handle form submit
        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const message = messageInput.value.trim();
            if (!message) return;

            // Clear welcome message on first message
            if (isFirstMessage) {
                chatMessages.innerHTML = '';
                isFirstMessage = false;
            }

            // Add user message immediately
            const userTimestamp = new Date().toISOString();
            addMessage(message, 'user', userTimestamp);

            // Clear input immediately
            messageInput.value = '';
            messageInput.style.height = 'auto';

            // Show typing indicator
            showTypingIndicator();

            // Simulate AI response delay
            setTimeout(() => {
                removeTypingIndicator();
                const response = getAIResponse(message);
                const aiTimestamp = new Date().toISOString();
                addMessage(response, 'ai', aiTimestamp);
            }, 1000 + Math.random() * 1000);
        });

        function getAIResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Check for specific keywords
            for (const [key, responses] of Object.entries(aiResponses)) {
                if (key !== 'default' && lowerMessage.includes(key)) {
                    return responses[Math.floor(Math.random() * responses.length)];
                }
            }
            
            // Return default response
            const defaults = aiResponses.default;
            return defaults[Math.floor(Math.random() * defaults.length)];
        }

        function addMessage(text, sender, timestamp = null) {
            let date;
            if (timestamp) {
                date = new Date(timestamp.replace(' ', 'T'));
            } else {
                date = new Date();
            }
            
            const options = {
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            };
            
            const timeString = date.toLocaleTimeString('en-US', options);
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = sender === 'user' ? 'ðŸ‘¤' : 'ðŸ¤–';
            
            const content = document.createElement('div');
            content.className = 'message-content';
            
            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            bubble.textContent = text;
            
            const time = document.createElement('div');
            time.className = 'message-time';
            time.textContent = timeString;
            time.setAttribute('data-timestamp', date.toISOString());
            
            content.appendChild(bubble);
            content.appendChild(time);
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const indicator = document.createElement('div');
            indicator.className = 'typing-indicator';
            indicator.id = 'typingIndicator';
            
            indicator.innerHTML = `
                <div class="message-avatar">ðŸ¤–</div>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            
            chatMessages.appendChild(indicator);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }
    </script>
</body>
</html>
